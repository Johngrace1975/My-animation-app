<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TweenCraft Ultra ‚Äì Fixed</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>

<style>
:root {
  --accent:#ff9f43;
  --panel:#1a1a1a;
  --bg:#0d0d0d;
}
body,html{
  margin:0;
  height:100%;
  background:var(--bg);
  color:white;
  font-family:Segoe UI,sans-serif;
}
#home,#studio{height:100%;display:flex;flex-direction:column}
#studio{display:none}
.header{
  height:48px;
  background:#111;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 12px;
}
.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:15px;
  padding:20px;
}
.card{
  background:var(--panel);
  border-radius:15px;
  overflow:hidden;
  cursor:pointer;
}
.card img{width:100%;height:120px;object-fit:cover}
.card p{text-align:center;margin:6px;font-weight:bold}
.main{
  flex:1;
  display:flex;
}
.sidebar{
  width:60px;
  background:#141414;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:12px;
  padding-top:12px;
}
.tool{
  width:42px;height:42px;
  background:#222;
  border-radius:12px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}
#canvasWrap{
  flex:1;
  display:flex;
  align-items:center;
  justify-content:center;
  background:black;
}
.audio{
  display:flex;
  padding:8px;
  gap:8px;
  background:#111;
}
.audio button{
  flex:1;
  border:none;
  border-radius:10px;
  padding:10px;
  font-weight:bold;
  color:white;
}
</style>
</head>

<body>

<div id="home">
  <h2 style="text-align:center;color:var(--accent)">TweenCraft Ultra</h2>
  <p style="text-align:center;color:#888">Choose a location</p>

  <div class="grid">
    <div class="card" onclick="start('beach')">
      <img src="https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=400">
      <p>Beach</p>
    </div>
    <div class="card" onclick="start('office')">
      <img src="https://images.unsplash.com/photo-1497366216548-37526070297c?w=400">
      <p>Office</p>
    </div>
    <div class="card" onclick="start('park')">
      <img src="https://images.unsplash.com/photo-1519331379826-f10be5486c6f?w=400">
      <p>Park</p>
    </div>
    <div class="card" onclick="start('green')">
      <div style="height:120px;background:#00ff00"></div>
      <p>Green Screen</p>
    </div>
  </div>
</div>

<div id="studio">
  <div class="header">
    <b>STUDIO</b>
    <button onclick="alert('Export coming soon')"
      style="background:var(--accent);border:none;border-radius:20px;padding:6px 14px;font-weight:bold">EXPORT</button>
  </div>

  <div class="main">
    <div class="sidebar">
      <div class="tool" onclick="addActor()">üë¶</div>
      <div class="tool" onclick="addDialogue()">üí¨</div>
      <div class="tool" onclick="goHome()">üè†</div>
    </div>

    <div id="canvasWrap">
      <canvas id="c"></canvas>
    </div>
  </div>

  <div class="audio">
    <button style="background:#e74c3c" onclick="record()">üéôÔ∏è REC</button>
    <button style="background:#9b59b6" onclick="aiTalk()">‚ú® AI VOICE</button>
  </div>
</div>

<script>
const canvas = new fabric.Canvas('c',{selection:false});
let actor=null;
let bubble=null;

function resize(){
  const h=window.innerHeight-150;
  const w=h*9/16;
  canvas.setDimensions({width:w,height:h});
  canvas.renderAll();
}
window.onresize=resize;

function start(type){
  document.getElementById('home').style.display='none';
  document.getElementById('studio').style.display='flex';
  resize();

  if(type==='green'){
    canvas.backgroundColor='#00ff00';
    canvas.renderAll();
    return;
  }

  const imgs={
    beach:'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=1200',
    office:'https://images.unsplash.com/photo-1497366216548-37526070297c?w=1200',
    park:'https://images.unsplash.com/photo-1519331379826-f10be5486c6f?w=1200'
  };

  fabric.Image.fromURL(imgs[type],img=>{
    img.scaleToWidth(canvas.width);
    img.scaleToHeight(canvas.height);
    canvas.setBackgroundImage(img,canvas.renderAll.bind(canvas));
  },{crossOrigin:'anonymous'});
}

function addActor(){
  fabric.Image.fromURL(
    'https://cdn-icons-png.flaticon.com/512/4333/4333609.png',
    img=>{
      img.scale(0.35);
      img.left=canvas.width/2;
      img.top=canvas.height-20;
      img.originX='center';
      img.originY='bottom';
      actor=img;
      canvas.add(img);
      canvas.setActiveObject(img);
    },{crossOrigin:'anonymous'}
  );
}

function addDialogue(){
  if(!actor)return alert('Add actor first');
  if(bubble)canvas.remove(bubble);

  bubble=new fabric.Textbox('Hello!',{
    fontSize:18,
    backgroundColor:'white',
    fill:'black',
    padding:8,
    originX:'center'
  });

  bubble.left=actor.left;
  bubble.top=actor.top-120;
  canvas.add(bubble);

  actor.on('moving',()=>{
    bubble.left=actor.left;
    bubble.top=actor.top-120;
  });
}

function aiTalk(){
  if(!actor)return;
  const text=prompt('Enter dialogue');
  if(!text)return;

  const utter=new SpeechSynthesisUtterance(text);
  let talking=true;

  function mouth(){
    if(!talking)return;
    actor.scaleY=actor.scaleY===0.35?0.32:0.35;
    canvas.renderAll();
    setTimeout(mouth,140);
  }

  utter.onstart=()=>mouth();
  utter.onend=()=>{talking=false;actor.scaleY=0.35;canvas.renderAll();}
  speechSynthesis.speak(utter);
}

function record(){alert('Recording coming soon')}
function goHome(){location.reload()}
</script>

</body>
</html>
