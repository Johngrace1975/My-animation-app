<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TweenCraft Web - Backgrounds</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; text-align: center; background: #2c3e50; color: white; }
        #canvas-container { margin: 20px auto; border: 8px solid #ecf0f1; width: 800px; box-shadow: 0px 10px 30px rgba(0,0,0,0.5); }
        .toolbar { margin: 20px; padding: 15px; background: #34495e; display: inline-block; border-radius: 10px; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; font-weight: bold; border-radius: 5px; border: none; transition: 0.3s; }
        .btn-char { background: #2ecc71; color: white; }
        .btn-bg { background: #3498db; color: white; }
        button:hover { opacity: 0.8; transform: scale(1.05); }
    </style>
</head>
<body>

    <h1>TweenCraft Web Editor</h1>
    
    <div class="toolbar">
        <strong>Characters:</strong>
        <button class="btn-char" onclick="addCharacter()">+ Add Character</button>
        <br><br>
        <strong>Backgrounds:</strong>
        <button class="btn-bg" onclick="changeBG('https://images.unsplash.com/photo-1519331379826-f10be5486c6f?q=80&w=800')">Park</button>
        <button class="btn-bg" onclick="changeBG('https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?q=80&w=800')">City</button>
        <button class="btn-bg" onclick="changeBG('')">Clear BG</button>
    </div>

    <div id="canvas-container">
        <canvas id="stage" width="800" height="500"></canvas>
    </div>

    <script>
        const canvas = new fabric.Canvas('stage');

        // Function to change the background image
        function changeBG(url) {
            if (!url) {
                canvas.setBackgroundImage(null, canvas.renderAll.bind(canvas));
                return;
            }
            fabric.Image.fromURL(url, function(img) {
                // Scale image to cover the whole canvas
                canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas), {
                    scaleX: canvas.width / img.width,
                    scaleY: canvas.height / img.height
                });
            });
        }

        // Function to add a character
        function addCharacter() {
            const charUrl = 'https://cdn-icons-png.flaticon.com/512/3426/3426653.png';
            fabric.Image.fromURL(charUrl, function(img) {
                img.set({
                    left: Math.random() * 400,
                    top: 150,
                    scaleX: 0.3,
                    scaleY: 0.3
                });
                canvas.add(img);
            });
        }

        // Add an initial character so it's not empty
        addCharacter();
    </script>
</body>
</html>
  dataArray = new Uint8Array(analyser.frequencyBinCount);
  statusText.textContent = "ðŸŽ™ Listening...";
  animateMouth();
};

stopBtn.onclick = () => {
  if (stream) stream.getTracks().forEach(t => t.stop());
  mouth.style.height = "10px";
  statusText.textContent = "Stopped";
};

function animateMouth() {
  analyser.getByteFrequencyData(dataArray);
  let volume = dataArray.reduce((a, b) => a + b) / dataArray.length;
  mouth.style.height = Math.min(60, volume * 0.8) + "px";
  requestAnimationFrame(animateMouth);
}

function blink() {
  eyeL.style.transform = "scaleY(0.1)";
  eyeR.style.transform = "scaleY(0.1)";
  setTimeout(() => {
    eyeL.style.transform = "scaleY(1)";
    eyeR.style.transform = "scaleY(1)";
  }, 150);
}

setInterval(blink, 3000 + Math.random() * 2000);
</script>

</body>
</html>
